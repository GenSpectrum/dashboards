---
import { getSession } from 'auth-astro/server';

import NotLoggedIn from '../../components/auth/NotLoggedIn.astro';
import { Subscriptions } from '../../components/subscriptions/overview/Subscriptions';
import BaseLayout from '../../layouts/base/BaseLayout.astro';
import { organismsSchema } from '../../types/Organism';

const session = await getSession(Astro.request);

const organisms = organismsSchema.parse(Astro.url.searchParams.getAll('organism'));
---

<BaseLayout title='Subscriptions'>
    {
        session?.user?.id !== undefined ? (
            <Subscriptions client:load organismsFromUrl={organisms} userId={session.user.id} />
        ) : (
            <NotLoggedIn />
        )
    }
</BaseLayout>
