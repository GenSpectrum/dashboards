import { type MutationAnnotations } from '@genspectrum/dashboard-components/util';

/* eslint-disable @typescript-eslint/naming-convention */
export const resistanceSetNames = {
    ThreeCLPro: '3CLpro',
    RdRp: 'RdRp',
    Spike: 'Spike',
} as const;
/* eslint-enable @typescript-eslint/naming-convention */

export type ResistanceSetName = (typeof resistanceSetNames)[keyof typeof resistanceSetNames];

export const RESISTANCE_MUTATIONS = {
    [resistanceSetNames.ThreeCLPro]: [
        'ORF1a:T3284I',
        'ORF1a:T3288A',
        'ORF1a:T3288N',
        'ORF1a:T3308I',
        'ORF1a:D3311Y',
        'ORF1a:M3312I',
        'ORF1a:M3312L',
        'ORF1a:M3312T',
        'ORF1a:M3312-',
        'ORF1a:L3313F',
        'ORF1a:G3401S',
        'ORF1a:F3403L',
        'ORF1a:F3403S',
        'ORF1a:N3405D',
        'ORF1a:N3405L',
        'ORF1a:N3405S',
        'ORF1a:G3406S',
        'ORF1a:S3407A',
        'ORF1a:S3407E',
        'ORF1a:S3407L',
        'ORF1a:S3407P',
        'ORF1a:C3423F',
        'ORF1a:M3428R',
        'ORF1a:M3428T',
        'ORF1a:E3429A',
        'ORF1a:E3429G',
        'ORF1a:E3429K',
        'ORF1a:E3429Q',
        'ORF1a:E3429V',
        'ORF1a:L3430F',
        'ORF1a:P3431-',
        'ORF1a:T3432I',
        'ORF1a:H3435L',
        'ORF1a:H3435N',
        'ORF1a:H3435Q',
        'ORF1a:H3435Y',
        'ORF1a:A3436T',
        'ORF1a:A3436V',
        'ORF1a:V3449A',
        'ORF1a:R3451G',
        'ORF1a:R3451S',
        'ORF1a:Q3452I',
        'ORF1a:Q3452K',
        'ORF1a:T3453I',
        'ORF1a:A3454T',
        'ORF1a:A3454V',
        'ORF1a:Q3455A',
        'ORF1a:Q3455C',
        'ORF1a:Q3455D',
        'ORF1a:Q3455E',
        'ORF1a:Q3455F',
        'ORF1a:Q3455G',
        'ORF1a:Q3455H',
        'ORF1a:Q3455I',
        'ORF1a:Q3455K',
        'ORF1a:Q3455L',
        'ORF1a:Q3455N',
        'ORF1a:Q3455P',
        'ORF1a:Q3455R',
        'ORF1a:Q3455S',
        'ORF1a:Q3455T',
        'ORF1a:Q3455V',
        'ORF1a:Q3455W',
        'ORF1a:Q3455Y',
        'ORF1a:A3456P',
        'ORF1a:A3457S',
        'ORF1a:P3515L',
        'ORF1a:V3560A',
        'ORF1a:S3564P',
        'ORF1a:T3567I',
        'ORF1a:F3568L',
    ],
    [resistanceSetNames.RdRp]: [
        'ORF1b:V157A',
        'ORF1b:V157L',
        'ORF1b:N189S',
        'ORF1b:R276C',
        'ORF1b:A367V',
        'ORF1b:A440V',
        'ORF1b:F471L',
        'ORF1b:D475Y',
        'ORF1b:A517V',
        'ORF1b:V548L',
        'ORF1b:G662S',
        'ORF1b:S750A',
        'ORF1b:V783I',
        'ORF1b:E787G',
        'ORF1b:C790F',
        'ORF1b:C790R',
        'ORF1b:E793A',
        'ORF1b:E793D',
        'ORF1b:M915R',
    ],
    [resistanceSetNames.Spike]: [
        'S:P337H',
        'S:P337L',
        'S:P337R',
        'S:P337S',
        'S:P337T',
        'S:E340A',
        'S:E340D',
        'S:E340G',
        'S:E340K',
        'S:E340Q',
        'S:E340V',
        'S:T345P',
        'S:R346G',
        'S:R346I',
        'S:R346K',
        'S:R346S',
        'S:R346T',
        'S:K356Q',
        'S:K356T',
        'S:S371F',
        'S:S371L',
        'S:D405E',
        'S:D405N',
        'S:E406D',
        'S:K417E',
        'S:K417H',
        'S:K417I',
        'S:K417M',
        'S:K417N',
        'S:K417R',
        'S:K417S',
        'S:K417T',
        'S:D420A',
        'S:D420N',
        'S:N439K',
        'S:N440D',
        'S:N440E',
        'S:N440I',
        'S:N440K',
        'S:N440R',
        'S:N440T',
        'S:N440Y',
        'S:S443Y',
        'S:K444E',
        'S:K444F',
        'S:K444I',
        'S:K444L',
        'S:K444M',
        'S:K444N',
        'S:K444R',
        'S:K444T',
        'S:V445A',
        'S:V445D',
        'S:V445F',
        'S:V445I',
        'S:V445L',
        'S:G446A',
        'S:G446D',
        'S:G446I',
        'S:G446N',
        'S:G446R',
        'S:G446S',
        'S:G446T',
        'S:G446V',
        'S:G447C',
        'S:G447D',
        'S:G447F',
        'S:G447S',
        'S:G447V',
        'S:N448D',
        'S:N448K',
        'S:N448T',
        'S:N448Y',
        'S:Y449D',
        'S:N450D',
        'S:N450K',
        'S:L452M',
        'S:L452Q',
        'S:L452R',
        'S:L452W',
        'S:Y453F',
        'S:Y453H',
        'S:L455F',
        'S:L455M',
        'S:L455S',
        'S:L455W',
        'S:F456C',
        'S:F456L',
        'S:F456V',
        'S:S459P',
        'S:N460D',
        'S:N460H',
        'S:N460I',
        'S:N460K',
        'S:N460S',
        'S:N460T',
        'S:N460Y',
        'S:A475D',
        'S:A475V',
        'S:G476D',
        'S:G476R',
        'S:G476T',
        'S:V483A',
        'S:E484A',
        'S:E484D',
        'S:E484G',
        'S:E484K',
        'S:E484P',
        'S:E484Q',
        'S:E484R',
        'S:E484S',
        'S:E484T',
        'S:E484V',
        'S:G485D',
        'S:G485R',
        'S:F486D',
        'S:F486I',
        'S:F486L',
        'S:F486N',
        'S:F486P',
        'S:F486S',
        'S:F486T',
        'S:F486V',
        'S:N487D',
        'S:N487H',
        'S:N487S',
        'S:Y489H',
        'S:Y489W',
        'S:F490G',
        'S:F490I',
        'S:F490L',
        'S:F490R',
        'S:F490S',
        'S:F490V',
        'S:F490Y',
        'S:Q493D',
        'S:Q493E',
        'S:Q493H',
        'S:Q493K',
        'S:Q493L',
        'S:Q493R',
        'S:Q493V',
        'S:S494P',
        'S:S494R',
        'S:G496S',
        'S:Q498H',
        'S:P499H',
        'S:P499R',
        'S:P499S',
        'S:P499T',
        'S:N501T',
        'S:N501Y',
        'S:G504C',
        'S:G504D',
        'S:G504I',
        'S:G504L',
        'S:G504N',
        'S:G504R',
        'S:G504V',
        'S:P507A',
        'S:N856K',
        'S:N969K',
        'S:E990A',
        'S:T1009I',
    ],
};

const fetchSnippet =
    'as per <a class="link" href="https://covdb.stanford.edu/drms">Stanford Coronavirus Antiviral & Resistance database</a> (last updated on 21 August 2024).';

// Hardcoded mature protein positions for 3CLpro (mature starts at genomic 3264, so position = genomic - 3263)
/* eslint-disable @typescript-eslint/naming-convention */
const threeCLProMaturePositions: Record<string, number> = {
    'ORF1a:T3284I': 21,
    'ORF1a:T3288A': 25,
    'ORF1a:T3288N': 25,
    'ORF1a:T3308I': 45,
    'ORF1a:D3311Y': 48,
    'ORF1a:M3312I': 49,
    'ORF1a:M3312L': 49,
    'ORF1a:M3312T': 49,
    'ORF1a:M3312-': 49,
    'ORF1a:L3313F': 50,
    'ORF1a:G3401S': 138,
    'ORF1a:F3403L': 140,
    'ORF1a:F3403S': 140,
    'ORF1a:N3405D': 142,
    'ORF1a:N3405L': 142,
    'ORF1a:N3405S': 142,
    'ORF1a:G3406S': 143,
    'ORF1a:S3407A': 144,
    'ORF1a:S3407E': 144,
    'ORF1a:S3407L': 144,
    'ORF1a:S3407P': 144,
    'ORF1a:C3423F': 160,
    'ORF1a:M3428R': 165,
    'ORF1a:M3428T': 165,
    'ORF1a:E3429A': 166,
    'ORF1a:E3429G': 166,
    'ORF1a:E3429K': 166,
    'ORF1a:E3429Q': 166,
    'ORF1a:E3429V': 166,
    'ORF1a:L3430F': 167,
    'ORF1a:P3431-': 168,
    'ORF1a:T3432I': 169,
    'ORF1a:H3435L': 172,
    'ORF1a:H3435N': 172,
    'ORF1a:H3435Q': 172,
    'ORF1a:H3435Y': 172,
    'ORF1a:A3436T': 173,
    'ORF1a:A3436V': 173,
    'ORF1a:V3449A': 186,
    'ORF1a:R3451G': 188,
    'ORF1a:R3451S': 188,
    'ORF1a:Q3452I': 189,
    'ORF1a:Q3452K': 189,
    'ORF1a:T3453I': 190,
    'ORF1a:A3454T': 191,
    'ORF1a:A3454V': 191,
    'ORF1a:Q3455A': 192,
    'ORF1a:Q3455C': 192,
    'ORF1a:Q3455D': 192,
    'ORF1a:Q3455E': 192,
    'ORF1a:Q3455F': 192,
    'ORF1a:Q3455G': 192,
    'ORF1a:Q3455H': 192,
    'ORF1a:Q3455I': 192,
    'ORF1a:Q3455K': 192,
    'ORF1a:Q3455L': 192,
    'ORF1a:Q3455N': 192,
    'ORF1a:Q3455P': 192,
    'ORF1a:Q3455R': 192,
    'ORF1a:Q3455S': 192,
    'ORF1a:Q3455T': 192,
    'ORF1a:Q3455V': 192,
    'ORF1a:Q3455W': 192,
    'ORF1a:Q3455Y': 192,
    'ORF1a:A3456P': 193,
    'ORF1a:A3457S': 194,
    'ORF1a:P3515L': 252,
    'ORF1a:V3560A': 297,
    'ORF1a:S3564P': 301,
    'ORF1a:T3567I': 304,
    'ORF1a:F3568L': 305,
};
/* eslint-enable @typescript-eslint/naming-convention */

// Hardcoded mature protein positions for RdRp (from original mature positions)
/* eslint-disable @typescript-eslint/naming-convention */
const rdRpMaturePositions: Record<string, number> = {
    'ORF1b:V157A': 166,
    'ORF1b:V157L': 166,
    'ORF1b:N189S': 198,
    'ORF1b:R276C': 285,
    'ORF1b:A367V': 376,
    'ORF1b:A440V': 449,
    'ORF1b:F471L': 480,
    'ORF1b:D475Y': 484,
    'ORF1b:A517V': 526,
    'ORF1b:V548L': 557,
    'ORF1b:G662S': 671,
    'ORF1b:S750A': 759,
    'ORF1b:V783I': 792,
    'ORF1b:E787G': 796,
    'ORF1b:C790F': 799,
    'ORF1b:C790R': 799,
    'ORF1b:E793A': 802,
    'ORF1b:E793D': 802,
    'ORF1b:M915R': 924,
};
/* eslint-enable @typescript-eslint/naming-convention */

// Helper to format mature mutation name
function formatMatureName(mutation: string, gene: string, position: number): string {
    const parts = mutation.split(':')[1]; // e.g., 'V157A'
    const originalBase = parts[0];
    const newBase = parts[parts.length - 1];
    return `${mutation} (${gene}:${originalBase}${position}${newBase})`;
}

export const resistanceMutationAnnotations: MutationAnnotations = [
    // RdRp: individual annotations per mutation with mature notation in name
    ...RESISTANCE_MUTATIONS.RdRp.map((mutation) => ({
        name: formatMatureName(mutation, 'RdRp', rdRpMaturePositions[mutation]),
        symbol: 'r',
        description: `SARS-CoV-2 RNA-dependent RNA polymerase (RdRP) inhibitor resistance mutation ${fetchSnippet}`,
        aminoAcidMutations: [mutation],
    })),
    // 3CLpro: individual annotations per mutation with mature notation in name
    ...RESISTANCE_MUTATIONS['3CLpro'].map((mutation) => ({
        name: formatMatureName(mutation, '3CLpro', threeCLProMaturePositions[mutation]),
        symbol: 'c',
        description: `SARS-CoV-2 3C-like protease (3CLpro, or Mpro for Main protease) inhibitor resistance mutation ${fetchSnippet}`,
        aminoAcidMutations: [mutation],
    })),
    // Spike: individual annotations per mutation
    ...RESISTANCE_MUTATIONS.Spike.map((mutation) => ({
        name: mutation,
        symbol: 's',
        description: `SARS-CoV-2 Spike monoclonal antibody (mAb) resistance mutation ${fetchSnippet}`,
        aminoAcidMutations: [mutation],
    })),
];
